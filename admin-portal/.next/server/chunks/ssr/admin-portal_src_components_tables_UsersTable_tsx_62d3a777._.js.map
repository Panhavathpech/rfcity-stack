{"version":3,"sources":["../../../../../admin-portal/src/components/tables/UsersTable.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { AdminUserRecord, UserRole } from \"@/lib/types\";\n\ntype Props = {\n  initialUsers: Omit<AdminUserRecord, \"passwordHash\">[];\n  viewerRole: UserRole;\n};\n\nconst roles: UserRole[] = [\"owner\", \"admin\", \"editor\", \"viewer\"];\n\nexport function UsersTable({ initialUsers, viewerRole }: Props) {\n  const [users, setUsers] = useState(initialUsers);\n  const [formState, setFormState] = useState<{\n    email: string;\n    role: UserRole;\n    status: \"active\" | \"invited\" | \"disabled\";\n  }>({ email: \"\", role: \"viewer\", status: \"invited\" });\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const canManage = viewerRole === \"owner\";\n\n  async function createUser(event: React.FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n    if (!canManage) {\n      return;\n    }\n    setIsSubmitting(true);\n    setError(null);\n\n    const response = await fetch(\"/api/users\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(formState),\n    });\n\n    setIsSubmitting(false);\n\n    if (!response.ok) {\n      const message = await response.json().catch(() => ({}));\n      setError(message?.message ?? \"Unable to invite user\");\n      return;\n    }\n\n    const data = await response.json();\n    setUsers((prev) => [data.user, ...prev]);\n    setFormState({ email: \"\", role: \"viewer\", status: \"invited\" });\n  }\n\n  async function updateUser(id: string, payload: Record<string, unknown>) {\n    const response = await fetch(`/api/users/${id}`, {\n      method: \"PATCH\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(payload),\n    });\n    if (!response.ok) {\n      alert(\"Unable to update user. Check your permissions and try again.\");\n      return;\n    }\n    const data = await fetch(\"/api/users\").then((res) => res.json());\n    setUsers(data.users);\n  }\n\n  async function disableUser(id: string) {\n    if (!confirm(\"Disable this user?\")) {\n      return;\n    }\n\n    const response = await fetch(`/api/users/${id}`, { method: \"DELETE\" });\n    if (!response.ok) {\n      alert(\"Unable to disable user.\");\n      return;\n    }\n    setUsers((prev) =>\n      prev.map((user) =>\n        user.id === id ? { ...user, status: \"disabled\" } : user,\n      ),\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm\">\n        <h2 className=\"text-lg font-semibold text-slate-900\">Invite user</h2>\n        {canManage ? (\n          <form className=\"mt-5 grid gap-4 sm:grid-cols-3\" onSubmit={createUser}>\n            <div className=\"sm:col-span-3\">\n              <label className=\"text-sm font-semibold text-slate-600\">\n                Email\n              </label>\n              <input\n                type=\"email\"\n                value={formState.email}\n                onChange={(event) =>\n                  setFormState((prev) => ({ ...prev, email: event.target.value }))\n                }\n                className=\"mt-2 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-100\"\n                placeholder=\"teammate@example.com\"\n                required\n              />\n            </div>\n            <div>\n              <label className=\"text-sm font-semibold text-slate-600\">\n                Role\n              </label>\n              <select\n                value={formState.role}\n                onChange={(event) =>\n                  setFormState((prev) => ({\n                    ...prev,\n                    role: event.target.value as UserRole,\n                  }))\n                }\n                className=\"mt-2 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-100\"\n              >\n                {roles.map((role) => (\n                  <option key={role} value={role}>\n                    {role}\n                  </option>\n                ))}\n              </select>\n            </div>\n            <div>\n              <label className=\"text-sm font-semibold text-slate-600\">\n                Status\n              </label>\n              <select\n                value={formState.status}\n                onChange={(event) =>\n                  setFormState((prev) => ({\n                    ...prev,\n                    status: event.target.value as typeof formState.status,\n                  }))\n                }\n                className=\"mt-2 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-100\"\n              >\n                <option value=\"invited\">Invited</option>\n                <option value=\"active\">Active</option>\n                <option value=\"disabled\">Disabled</option>\n              </select>\n            </div>\n            <div className=\"sm:col-span-3\">\n              <button\n                type=\"submit\"\n                disabled={isSubmitting}\n                className=\"w-full rounded-xl bg-emerald-600 px-4 py-3 text-sm font-semibold uppercase tracking-wide text-white transition hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-70\"\n              >\n                {isSubmitting ? \"Sending invite...\" : \"Send invite\"}\n              </button>\n              {error ? (\n                <p className=\"mt-2 text-sm text-red-600\">{error}</p>\n              ) : null}\n            </div>\n          </form>\n        ) : (\n          <p className=\"mt-4 text-sm text-slate-500\">\n            Only owners can invite new users.\n          </p>\n        )}\n      </div>\n\n      <div className=\"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm\">\n        <h2 className=\"text-lg font-semibold text-slate-900\">Team</h2>\n        <div className=\"mt-4 overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-slate-100 text-sm\">\n            <thead>\n              <tr className=\"text-left text-xs uppercase tracking-wide text-slate-500\">\n                <th className=\"px-3 py-3\">Email</th>\n                <th className=\"px-3 py-3\">Role</th>\n                <th className=\"px-3 py-3\">Status</th>\n                <th className=\"px-3 py-3\">Actions</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-slate-100\">\n              {users.map((user) => (\n                <tr key={user.id}>\n                  <td className=\"px-3 py-3 font-semibold\">{user.email}</td>\n                  <td className=\"px-3 py-3\">{user.role}</td>\n                  <td className=\"px-3 py-3\">{user.status}</td>\n                  <td className=\"px-3 py-3\">\n                    <div className=\"flex flex-wrap gap-2\">\n                      <button\n                        onClick={() =>\n                          updateUser(user.id, {\n                            status:\n                              user.status === \"disabled\" ? \"active\" : \"disabled\",\n                          })\n                        }\n                        className=\"rounded-full border border-slate-200 px-4 py-1 text-xs font-semibold uppercase tracking-wide text-slate-600 hover:border-emerald-200 hover:text-emerald-700\"\n                      >\n                        {user.status === \"disabled\" ? \"Activate\" : \"Disable\"}\n                      </button>\n                      {user.role !== \"owner\" ? (\n                        <button\n                          onClick={() =>\n                            updateUser(user.id, {\n                              role: user.role === \"viewer\" ? \"editor\" : \"viewer\",\n                            })\n                          }\n                          className=\"rounded-full border border-slate-200 px-4 py-1 text-xs font-semibold uppercase tracking-wide text-slate-600 hover:border-emerald-200 hover:text-emerald-700\"\n                        >\n                          Toggle Role\n                        </button>\n                      ) : null}\n                      <button\n                        onClick={() =>\n                          updateUser(user.id, {\n                            password: generatePassword(),\n                          })\n                        }\n                        className=\"rounded-full border border-slate-200 px-4 py-1 text-xs font-semibold uppercase tracking-wide text-slate-600 hover:border-emerald-200 hover:text-emerald-700\"\n                      >\n                        Reset Password\n                      </button>\n                      {viewerRole === \"owner\" ? (\n                        <button\n                          onClick={() => disableUser(user.id)}\n                          className=\"rounded-full border border-red-200 px-4 py-1 text-xs font-semibold uppercase tracking-wide text-red-600 hover:bg-red-50\"\n                        >\n                          Archive\n                        </button>\n                      ) : null}\n                    </div>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction generatePassword() {\n  const cryptoApi = globalThis.crypto;\n  const buf = cryptoApi.getRandomValues(new Uint8Array(6));\n  return Array.from(buf, (byte) => (byte % 36).toString(36)).join(\"\");\n}\n\n"],"names":[],"mappings":"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"}