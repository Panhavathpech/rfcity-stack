{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/macbookpro/Documents/Personal%20Works/Vibe%20Coding/Antigravity/R%26F%20City/admin-portal/src/components/tables/UsersTable.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { AdminUserRecord, UserRole } from \"@/lib/types\";\n\ntype Props = {\n  initialUsers: Omit<AdminUserRecord, \"passwordHash\">[];\n  viewerRole: UserRole;\n};\n\nconst roles: UserRole[] = [\"owner\", \"admin\", \"editor\", \"viewer\"];\n\nexport function UsersTable({ initialUsers, viewerRole }: Props) {\n  const [users, setUsers] = useState(initialUsers);\n  const [formState, setFormState] = useState<{\n    email: string;\n    role: UserRole;\n    status: \"active\" | \"invited\" | \"disabled\";\n  }>({ email: \"\", role: \"viewer\", status: \"invited\" });\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const canManage = viewerRole === \"owner\";\n\n  async function createUser(event: React.FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n    if (!canManage) {\n      return;\n    }\n    setIsSubmitting(true);\n    setError(null);\n\n    const response = await fetch(\"/api/users\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(formState),\n    });\n\n    setIsSubmitting(false);\n\n    if (!response.ok) {\n      const message = await response.json().catch(() => ({}));\n      setError(message?.message ?? \"Unable to invite user\");\n      return;\n    }\n\n    const data = await response.json();\n    setUsers((prev) => [data.user, ...prev]);\n    setFormState({ email: \"\", role: \"viewer\", status: \"invited\" });\n  }\n\n  async function updateUser(id: string, payload: Record<string, unknown>) {\n    const response = await fetch(`/api/users/${id}`, {\n      method: \"PATCH\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(payload),\n    });\n    if (!response.ok) {\n      alert(\"Unable to update user. Check your permissions and try again.\");\n      return;\n    }\n    const data = await fetch(\"/api/users\").then((res) => res.json());\n    setUsers(data.users);\n  }\n\n  async function disableUser(id: string) {\n    if (!confirm(\"Disable this user?\")) {\n      return;\n    }\n\n    const response = await fetch(`/api/users/${id}`, { method: \"DELETE\" });\n    if (!response.ok) {\n      alert(\"Unable to disable user.\");\n      return;\n    }\n    setUsers((prev) =>\n      prev.map((user) =>\n        user.id === id ? { ...user, status: \"disabled\" } : user,\n      ),\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm\">\n        <h2 className=\"text-lg font-semibold text-slate-900\">Invite user</h2>\n        {canManage ? (\n          <form className=\"mt-5 grid gap-4 sm:grid-cols-3\" onSubmit={createUser}>\n            <div className=\"sm:col-span-3\">\n              <label className=\"text-sm font-semibold text-slate-600\">\n                Email\n              </label>\n              <input\n                type=\"email\"\n                value={formState.email}\n                onChange={(event) =>\n                  setFormState((prev) => ({ ...prev, email: event.target.value }))\n                }\n                className=\"mt-2 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-100\"\n                placeholder=\"teammate@example.com\"\n                required\n              />\n            </div>\n            <div>\n              <label className=\"text-sm font-semibold text-slate-600\">\n                Role\n              </label>\n              <select\n                value={formState.role}\n                onChange={(event) =>\n                  setFormState((prev) => ({\n                    ...prev,\n                    role: event.target.value as UserRole,\n                  }))\n                }\n                className=\"mt-2 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-100\"\n              >\n                {roles.map((role) => (\n                  <option key={role} value={role}>\n                    {role}\n                  </option>\n                ))}\n              </select>\n            </div>\n            <div>\n              <label className=\"text-sm font-semibold text-slate-600\">\n                Status\n              </label>\n              <select\n                value={formState.status}\n                onChange={(event) =>\n                  setFormState((prev) => ({\n                    ...prev,\n                    status: event.target.value as typeof formState.status,\n                  }))\n                }\n                className=\"mt-2 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-100\"\n              >\n                <option value=\"invited\">Invited</option>\n                <option value=\"active\">Active</option>\n                <option value=\"disabled\">Disabled</option>\n              </select>\n            </div>\n            <div className=\"sm:col-span-3\">\n              <button\n                type=\"submit\"\n                disabled={isSubmitting}\n                className=\"w-full rounded-xl bg-emerald-600 px-4 py-3 text-sm font-semibold uppercase tracking-wide text-white transition hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-70\"\n              >\n                {isSubmitting ? \"Sending invite...\" : \"Send invite\"}\n              </button>\n              {error ? (\n                <p className=\"mt-2 text-sm text-red-600\">{error}</p>\n              ) : null}\n            </div>\n          </form>\n        ) : (\n          <p className=\"mt-4 text-sm text-slate-500\">\n            Only owners can invite new users.\n          </p>\n        )}\n      </div>\n\n      <div className=\"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm\">\n        <h2 className=\"text-lg font-semibold text-slate-900\">Team</h2>\n        <div className=\"mt-4 overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-slate-100 text-sm\">\n            <thead>\n              <tr className=\"text-left text-xs uppercase tracking-wide text-slate-500\">\n                <th className=\"px-3 py-3\">Email</th>\n                <th className=\"px-3 py-3\">Role</th>\n                <th className=\"px-3 py-3\">Status</th>\n                <th className=\"px-3 py-3\">Actions</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-slate-100\">\n              {users.map((user) => (\n                <tr key={user.id}>\n                  <td className=\"px-3 py-3 font-semibold\">{user.email}</td>\n                  <td className=\"px-3 py-3\">{user.role}</td>\n                  <td className=\"px-3 py-3\">{user.status}</td>\n                  <td className=\"px-3 py-3\">\n                    <div className=\"flex flex-wrap gap-2\">\n                      <button\n                        onClick={() =>\n                          updateUser(user.id, {\n                            status:\n                              user.status === \"disabled\" ? \"active\" : \"disabled\",\n                          })\n                        }\n                        className=\"rounded-full border border-slate-200 px-4 py-1 text-xs font-semibold uppercase tracking-wide text-slate-600 hover:border-emerald-200 hover:text-emerald-700\"\n                      >\n                        {user.status === \"disabled\" ? \"Activate\" : \"Disable\"}\n                      </button>\n                      {user.role !== \"owner\" ? (\n                        <button\n                          onClick={() =>\n                            updateUser(user.id, {\n                              role: user.role === \"viewer\" ? \"editor\" : \"viewer\",\n                            })\n                          }\n                          className=\"rounded-full border border-slate-200 px-4 py-1 text-xs font-semibold uppercase tracking-wide text-slate-600 hover:border-emerald-200 hover:text-emerald-700\"\n                        >\n                          Toggle Role\n                        </button>\n                      ) : null}\n                      <button\n                        onClick={() =>\n                          updateUser(user.id, {\n                            password: generatePassword(),\n                          })\n                        }\n                        className=\"rounded-full border border-slate-200 px-4 py-1 text-xs font-semibold uppercase tracking-wide text-slate-600 hover:border-emerald-200 hover:text-emerald-700\"\n                      >\n                        Reset Password\n                      </button>\n                      {viewerRole === \"owner\" ? (\n                        <button\n                          onClick={() => disableUser(user.id)}\n                          className=\"rounded-full border border-red-200 px-4 py-1 text-xs font-semibold uppercase tracking-wide text-red-600 hover:bg-red-50\"\n                        >\n                          Archive\n                        </button>\n                      ) : null}\n                    </div>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction generatePassword() {\n  const cryptoApi = globalThis.crypto;\n  const buf = cryptoApi.getRandomValues(new Uint8Array(6));\n  return Array.from(buf, (byte) => (byte % 36).toString(36)).join(\"\");\n}\n\n"],"names":[],"mappings":"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"}}]
}